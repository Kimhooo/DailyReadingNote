[从内存映射mmap说开去](https://juejin.cn/post/6844903814571491342)

前几天在看到 `mmkv` 的源码提到了使用 `mmap`，能够避免crash，但是没有细说，找篇文章来看看。

所谓 `内存映射`，就是**将文件的磁盘扇区映射到进程的虚拟内存空间**的过程。

#### 步骤：

1. 创建虚拟区间
2. 完成地址映射
3. 将文件数据的拷贝至主存。
 
真正的文件读取是当进程发起读或写操作时。

#### 对比：
1. 常规文件操作需要从磁盘到页缓存再到用户主存的两次数据拷贝。
2. mmap操控文件，只需要从磁盘到用户主存的一次数据拷贝过程。

mmap的关键点是实现了用户空间和内核空间的数据直接交互而省去了空间不同数据不通的繁琐过程。因此mmap效率更高。 


```
换句话说，但凡是需要用磁盘空间代替内存的时候，mmap都可以发挥其功效。
```
Binder 也是。
